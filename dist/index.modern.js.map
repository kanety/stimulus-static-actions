{"version":3,"file":"index.modern.js","sources":["../src/action.js","../src/action_setter.js","../src/inheritable_statics.js","../src/index.js"],"sourcesContent":["export default class Action {\n  constructor(identifier, definition) {\n    this.identifier = identifier;\n    this.name = definition[0];\n    this.descriptor = definition[1];\n    this.options = definition[2] || {};\n  };\n\n  get description() {\n    if (this.descriptor.includes('->')) {\n      return this.descriptor.replace(/->/, `->${this.identifier}#`);\n    } else {\n      return `${this.identifier}#${this.descriptor}`;\n    }\n  }\n}\n","import Action from './action';\r\nimport { readInheritableStaticArrayValues } from './inheritable_statics';\r\n\r\nexport default class ActionSetter {\r\n  constructor(context) {\r\n    this.context = context;\r\n    this.controller = context.controller;\r\n\r\n    let definitions = readInheritableStaticArrayValues(this.controller.constructor, 'actions');\r\n    this.actions = this.compile(definitions);\r\n  }\r\n\r\n  compile(definitions) {\r\n    return definitions.map((definition) => {\r\n      return new Action(this.controller.identifier, definition);\r\n    });\r\n  }\r\n\r\n  run() {\r\n    this.actions.forEach((action) => {\r\n      let targets = this.resolveTargets(action);\r\n      targets.forEach((target) => {\r\n        this.attachAction(target, action);\r\n      });\r\n    });\r\n  };\r\n\r\n  resolveTargets(action) {\r\n    let targets = this.findTargets(action.name);\r\n\r\n    if (action.options.if) {\r\n      return this.filterTargets(targets, action.options.if);\r\n    } else {\r\n      return targets;\r\n    }\r\n  }\r\n\r\n  findTargets(name) {\r\n    if (name == 'element') {\r\n      return [this.controller.element];\r\n    } else if (this.controller[`${name}Targets`]) {\r\n      return [].concat(this.controller[`${name}Targets`]);\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  filterTargets(targets, ifvalue) {\r\n    return targets.filter((target) => {\r\n      let property = this.controller[ifvalue];\r\n      if (typeof(property) == 'function') {\r\n        property = property.apply(this.controller, target);\r\n      }\r\n      return property != false\r\n    });\r\n  }\r\n\r\n  attachAction(target, action) {\r\n    let description = action.description;\r\n    let currentActions = (target.dataset['action'] || '').split(' ');\r\n    if (!currentActions.some((ca) => ca == description)) {\r\n      currentActions.push(description);\r\n    }\r\n    target.dataset['action'] = currentActions.join(' ').trim();\r\n  }\r\n}\r\n","export function readInheritableStaticArrayValues(constructor, propertyName) {\r\n  let ancestors = getAncestorsForConstructor(constructor);\r\n  return Array.from(ancestors.reduce((values, constructor) => {\r\n    getOwnStaticArrayValues(constructor, propertyName).forEach(name => values.add(name));\r\n    return values;\r\n  }, new Set));\r\n}\r\n\r\nfunction getAncestorsForConstructor(constructor) {\r\n  const ancestors = [];\r\n  while (constructor) {\r\n    ancestors.push(constructor);\r\n    constructor = Object.getPrototypeOf(constructor);\r\n  }\r\n  return ancestors.reverse();\r\n}\r\n\r\nfunction getOwnStaticArrayValues(constructor, propertyName) {\r\n  const definition = constructor[propertyName];\r\n  return Array.isArray(definition) ? definition : [];\r\n}\r\n","import { Context } from '@hotwired/stimulus';\nimport ActionSetter from './action_setter';\n\nlet oConnect = Context.prototype.connect;\nlet oTargetConnected = Context.prototype.targetConnected;\n\nContext.prototype.connect = function() {\n  this.actionSetter = new ActionSetter(this);\n  this.actionSetter.run();\n  return oConnect.apply(this, arguments);\n};\n\nContext.prototype.targetConnected = function() {\n  this.actionSetter.run();\n  return oTargetConnected.apply(this, arguments);\n}\n"],"names":["Action","constructor","identifier","definition","this","name","descriptor","options","description","includes","replace","ActionSetter","context","controller","definitions","propertyName","ancestors","push","Object","getPrototypeOf","reverse","getAncestorsForConstructor","Array","from","reduce","values","isArray","getOwnStaticArrayValues","forEach","add","Set","readInheritableStaticArrayValues","actions","compile","map","run","action","resolveTargets","target","attachAction","targets","findTargets","if","filterTargets","element","concat","ifvalue","filter","property","apply","currentActions","dataset","split","some","ca","join","trim","oConnect","Context","prototype","connect","oTargetConnected","targetConnected","actionSetter","arguments"],"mappings":"mDAAqBA,EACnBC,YAAYC,EAAYC,GACtBC,KAAKF,WAAaA,EAClBE,KAAKC,KAAOF,EAAW,GACvBC,KAAKE,WAAaH,EAAW,GAC7BC,KAAKG,QAAUJ,EAAW,IAAM,GAGnBK,kBACb,OAAIJ,KAAKE,WAAWG,SAAS,WACfH,WAAWI,QAAQ,KAAO,KAAIN,KAAKF,eAEvC,GAAEE,KAAKF,cAAcE,KAAKE,oBCTnBK,EACnBV,YAAYW,GACVR,KAAKQ,QAAUA,EACfR,KAAKS,WAAaD,EAAQC,WAE1B,IAAIC,WCRyCb,EAAac,GAC5D,IAAIC,EAON,SAAoCf,GAClC,MAAMe,EAAY,GAClB,KAAOf,GACLe,EAAUC,KAAKhB,GACfA,EAAciB,OAAOC,eAAelB,GAEtC,OAAOe,EAAUI,UAbDC,CAA2BpB,GAC3C,OAAOqB,MAAMC,KAAKP,EAAUQ,OAAO,CAACC,EAAQxB,KAe9C,SAAiCA,EAAac,GAC5C,MAAMZ,EAAaF,EAAW,QAC9B,OAAOqB,MAAMI,QAAQvB,GAAcA,EAAa,GAhB9CwB,CAAwB1B,GAA2B2B,QAAQvB,GAAQoB,EAAOI,IAAIxB,IACvEoB,GACN,IAAIK,MDGaC,CAAiC3B,KAAKS,WAAWZ,aACnEG,KAAK4B,QAAU5B,KAAK6B,QAAQnB,GAG9BmB,QAAQnB,GACN,OAAOA,EAAYoB,IAAK/B,OACXH,EAAOI,KAAKS,WAAWX,WAAYC,IAIlDgC,MACE/B,KAAK4B,QAAQJ,QAASQ,IACNhC,KAAKiC,eAAeD,GAC1BR,QAASU,IACflC,KAAKmC,aAAaD,EAAQF,OAKhCC,eAAeD,GACb,IAAII,EAAUpC,KAAKqC,YAAYL,EAAO/B,MAEtC,OAAI+B,EAAO7B,QAAQmC,QACLC,cAAcH,EAASJ,EAAO7B,QAAQmC,IAE3CF,EAIXC,YAAYpC,GACV,MAAY,WAARA,EACK,CAACD,KAAKS,WAAW+B,SACfxC,KAAKS,WAAY,GAAER,YACrB,GAAGwC,OAAOzC,KAAKS,WAAY,GAAER,aAE7B,GAIXsC,cAAcH,EAASM,GACrB,OAAON,EAAQO,OAAQT,IACrB,IAAIU,EAAW5C,KAAKS,WAAWiC,GAI/B,MAHwB,mBAAbE,IACTA,EAAWA,EAASC,MAAM7C,KAAKS,WAAYyB,IAE1B,GAAZU,IAIXT,aAAaD,EAAQF,GACnB,IAAI5B,EAAc4B,EAAO5B,YACrB0C,GAAkBZ,EAAOa,QAAP,QAA4B,IAAIC,MAAM,KACvDF,EAAeG,KAAMC,GAAOA,GAAM9C,IACrC0C,EAAejC,KAAKT,GAEtB8B,EAAOa,QAAP,OAA2BD,EAAeK,KAAK,KAAKC,QE5DxD,IAAIC,EAAWC,EAAQC,UAAUC,QAC7BC,EAAmBH,EAAQC,UAAUG,gBAEzCJ,EAAQC,UAAUC,QAAU,WAG1B,OAFAxD,KAAK2D,aAAe,IAAIpD,EAAaP,MACrCA,KAAK2D,aAAa5B,MACXsB,EAASR,MAAM7C,KAAM4D,YAG9BN,EAAQC,UAAUG,gBAAkB,WAElC,OADA1D,KAAK2D,aAAa5B,MACX0B,EAAiBZ,MAAM7C,KAAM4D"}