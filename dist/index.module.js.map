{"version":3,"file":"index.module.js","sources":["../src/action.js","../src/action_set.js","../src/inheritable_statics.js","../src/index.js"],"sourcesContent":["export default class Action {\n  constructor(identifier, definition) {\n    this.identifier = identifier;\n    this.name = definition[0];\n    this.descriptor = definition[1];\n    this.options = definition[2] || {};\n  };\n\n  get description() {\n    if (this.descriptor.includes('->')) {\n      return this.descriptor.replace(/->/, `->${this.identifier}#`);\n    } else {\n      return `${this.identifier}#${this.descriptor}`;\n    }\n  }\n}\n","import Action from './action';\r\nimport { readInheritableStaticArrayValues } from './inheritable_statics';\r\n\r\nexport default class ActionSet {\r\n  constructor(context) {\r\n    this.context = context;\r\n    this.controller = context.controller;\r\n    this.actions = [];\r\n  }\r\n\r\n  run() {\r\n    this.add(readInheritableStaticArrayValues(this.controller.constructor, 'actions'));\r\n  }\r\n\r\n  add(definitions) {\r\n    let actions = definitions.map((definition) => new Action(this.controller.identifier, definition));\r\n\r\n    actions.forEach((action) => {\r\n      let targets = this.resolveTargets(action);\r\n      targets.forEach((target) => {\r\n        this.addAction(target, action);\r\n      });\r\n      this.actions.push(action);\r\n    });\r\n  }\r\n\r\n  remove(definitions) {\r\n    let actions = definitions.map((definition) => new Action(this.controller.identifier, definition));\r\n\r\n    actions.forEach((action) => {\r\n      let targets = this.resolveTargets(action);\r\n      targets.forEach((target) => {\r\n        this.removeAction(target, action);\r\n      });\r\n      this.actions = this.actions.filter((a) => a.description != action.description);\r\n    });\r\n  }\r\n\r\n  resolveTargets(action) {\r\n    let targets = this.findTargets(action.name);\r\n\r\n    if (action.options.if) {\r\n      return this.filterTargets(targets, action.options.if);\r\n    } else {\r\n      return targets;\r\n    }\r\n  }\r\n\r\n  findTargets(name) {\r\n    if (name == 'element') {\r\n      return [this.controller.element];\r\n    } else if (this.controller[`${name}Targets`]) {\r\n      return [].concat(this.controller[`${name}Targets`]);\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  filterTargets(targets, ifvalue) {\r\n    return targets.filter((target) => {\r\n      let property = this.controller[ifvalue];\r\n      if (typeof(property) == 'function') {\r\n        property = property.apply(this.controller, target);\r\n      }\r\n      return property != false\r\n    });\r\n  }\r\n\r\n  addAction(target, action) {\r\n    let description = action.description;\r\n    let currentDescriptions = (target.dataset['action'] || '').split(' ');\r\n    if (!currentDescriptions.some((currentDescription) => currentDescription == description)) {\r\n      currentDescriptions.push(description);\r\n    }\r\n    target.dataset['action'] = currentDescriptions.join(' ').trim();\r\n  }\r\n\r\n  removeAction(target, action) {\r\n    let description = action.description;\r\n    let currentDescriptions = (target.dataset['action'] || '').split(' ');\r\n    currentDescriptions = currentDescriptions.filter((currentDescription) => currentDescription != description);\r\n    target.dataset['action'] = currentDescriptions.join(' ').trim();\r\n  }\r\n}\r\n","export function readInheritableStaticArrayValues(constructor, propertyName) {\r\n  let ancestors = getAncestorsForConstructor(constructor);\r\n  return Array.from(ancestors.reduce((values, constructor) => {\r\n    getOwnStaticArrayValues(constructor, propertyName).forEach(name => values.add(name));\r\n    return values;\r\n  }, new Set));\r\n}\r\n\r\nfunction getAncestorsForConstructor(constructor) {\r\n  const ancestors = [];\r\n  while (constructor) {\r\n    ancestors.push(constructor);\r\n    constructor = Object.getPrototypeOf(constructor);\r\n  }\r\n  return ancestors.reverse();\r\n}\r\n\r\nfunction getOwnStaticArrayValues(constructor, propertyName) {\r\n  const definition = constructor[propertyName];\r\n  return Array.isArray(definition) ? definition : [];\r\n}\r\n","import { Context } from '@hotwired/stimulus';\nimport ActionSet from './action_set';\n\nlet oConnect = Context.prototype.connect;\nlet oTargetConnected = Context.prototype.targetConnected;\n\nContext.prototype.connect = function() {\n  this.actionSet = new ActionSet(this);\n  this.actionSet.run();\n  return oConnect.apply(this, arguments);\n};\n\nContext.prototype.targetConnected = function() {\n  this.actionSet.run();\n  return oTargetConnected.apply(this, arguments);\n}\n"],"names":["Action","identifier","definition","this","name","descriptor","options","includes","replace","ActionSet","context","controller","actions","run","ancestors","add","constructor","push","Object","getPrototypeOf","reverse","getAncestorsForConstructor","Array","from","reduce","values","propertyName","isArray","getOwnStaticArrayValues","forEach","Set","definitions","map","_this","action","resolveTargets","target","addAction","remove","_this2","removeAction","filter","a","description","targets","findTargets","filterTargets","element","concat","ifvalue","property","_this3","apply","currentDescriptions","dataset","split","some","currentDescription","join","trim","oConnect","Context","prototype","connect","oTargetConnected","targetConnected","actionSet","arguments"],"mappings":"iDAAqBA,aACnB,WAAYC,EAAYC,GACtBC,KAAKF,WAAaA,EAClBE,KAAKC,KAAOF,EAAW,GACvBC,KAAKE,WAAaH,EAAW,GAC7BC,KAAKG,QAAUJ,EAAW,IAAM,0CAGlC,WACE,OAAIC,KAAKE,WAAWE,SAAS,WACfF,WAAWG,QAAQ,UAAWL,KAAKF,qBAEhCA,eAAcE,KAAKE,yMCTnBI,aACnB,WAAYC,GACVP,KAAKO,QAAUA,EACfP,KAAKQ,WAAaD,EAAQC,WAC1BR,KAAKS,QAAU,8BAGjBC,IAAA,eCTIC,EDUFX,KAAKY,KCVHD,EAON,SAAoCE,GAElC,IADA,IAAMF,EAAY,GACXE,GACLF,EAAUG,KAAKD,GACfA,EAAcE,OAAOC,eAAeH,GAEtC,OAAOF,EAAUM,UAbDC,CDU4BlB,KAAKQ,WAAWK,aCTrDM,MAAMC,KAAKT,EAAUU,OAAO,SAACC,EAAQT,GAE1C,OAaJ,SAAiCA,EAAaU,GAC5C,IAAMxB,EAAac,EAAW,QAC9B,OAAOM,MAAMK,QAAQzB,GAAcA,EAAa,GAhB9C0B,CAAwBZ,GAA2Ba,QAAQ,SAAAzB,UAAQqB,EAAOV,IAAIX,KACvEqB,GACN,IAAIK,WDSPf,IAAA,SAAIgB,cACYA,EAAYC,IAAI,SAAC9B,cAAmBF,EAAOiC,EAAKtB,WAAWV,WAAYC,KAE7E2B,QAAQ,SAACK,GACDD,EAAKE,eAAeD,GAC1BL,QAAQ,SAACO,GACfH,EAAKI,UAAUD,EAAQF,KAEzBD,EAAKrB,QAAQK,KAAKiB,QAItBI,OAAA,SAAOP,cACSA,EAAYC,IAAI,SAAC9B,cAAmBF,EAAOuC,EAAK5B,WAAWV,WAAYC,KAE7E2B,QAAQ,SAACK,GACDK,EAAKJ,eAAeD,GAC1BL,QAAQ,SAACO,GACfG,EAAKC,aAAaJ,EAAQF,KAE5BK,EAAK3B,QAAU2B,EAAK3B,QAAQ6B,OAAO,SAACC,UAAMA,EAAEC,aAAeT,EAAOS,mBAItER,eAAA,SAAeD,GACb,IAAIU,EAAUzC,KAAK0C,YAAYX,EAAO9B,MAEtC,OAAI8B,EAAO5B,gBACGwC,cAAcF,EAASV,EAAO5B,YAEnCsC,KAIXC,YAAA,SAAYzC,GACV,MAAY,WAARA,EACK,CAACD,KAAKQ,WAAWoC,SACf5C,KAAKQ,WAAcP,aACrB,GAAG4C,OAAO7C,KAAKQ,WAAcP,cAE7B,MAIX0C,cAAA,SAAcF,EAASK,cACrB,OAAOL,EAAQH,OAAO,SAACL,GACrB,IAAIc,EAAWC,EAAKxC,WAAWsC,GAI/B,MAHwB,mBAAbC,IACTA,EAAWA,EAASE,MAAMD,EAAKxC,WAAYyB,IAE1B,GAAZc,OAIXb,UAAA,SAAUD,EAAQF,GAChB,IAAIS,EAAcT,EAAOS,YACrBU,GAAuBjB,EAAOkB,QAAP,QAA4B,IAAIC,MAAM,KAC5DF,EAAoBG,KAAK,SAACC,UAAuBA,GAAsBd,KAC1EU,EAAoBpC,KAAK0B,GAE3BP,EAAOkB,QAAP,OAA2BD,EAAoBK,KAAK,KAAKC,UAG3DnB,aAAA,SAAaJ,EAAQF,GACnB,IAAIS,EAAcT,EAAOS,YACrBU,GAAuBjB,EAAOkB,QAAP,QAA4B,IAAIC,MAAM,KACjEF,EAAsBA,EAAoBZ,OAAO,SAACgB,UAAuBA,GAAsBd,IAC/FP,EAAOkB,QAAP,OAA2BD,EAAoBK,KAAK,KAAKC,aE9EzDC,EAAWC,EAAQC,UAAUC,QAC7BC,EAAmBH,EAAQC,UAAUG,gBAEzCJ,EAAQC,UAAUC,QAAU,WAG1B,OAFA5D,KAAK+D,UAAY,IAAIzD,EAAUN,MAC/BA,KAAK+D,UAAUrD,MACR+C,EAASR,MAAMjD,KAAMgE,YAG9BN,EAAQC,UAAUG,gBAAkB,WAElC,OADA9D,KAAK+D,UAAUrD,MACRmD,EAAiBZ,MAAMjD,KAAMgE"}